# DrovaKeeneticDesktop ‚Äî –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ

1. [–û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã](#1-–æ–±–∑–æ—Ä-—Å–∏—Å—Ç–µ–º—ã)
2. [–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è](#2-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
3. [–†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ](#3-—Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ)
4. [–ù–∞—Å—Ç—Ä–æ–π–∫–∞](#4-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
5. [–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏](#5-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏)
6. [–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫](#6-—Ä—É—á–Ω–æ–π-–∑–∞–ø—É—Å–∫)
7. [–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫](#7-–∞–≤—Ç–æ–∑–∞–ø—É—Å–∫)
8. [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#8-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
9. [–û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞](#9-–æ—Ç–ª–∞–¥–∫–∞-–∏-–¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞)
10. [–°–ª—É–∂–µ–±–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã](#10-—Å–ª—É–∂–µ–±–Ω—ã–µ-—Å–∫—Ä–∏–ø—Ç—ã)
11. [–û—à–∏–±–∫–∏ –∏ –∏—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ](#11-–æ—à–∏–±–∫–∏-–∏-–∏—Ö-—É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ)

---

## 1. –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

**DrovaKeeneticDesktop** ‚Äî Python-–≤–æ—Ä–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ Linux-–º–∞—à–∏–Ω–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ä–æ—É—Ç–µ—Ä–µ Keenetic) –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏–≥—Ä–æ–≤—ã–º Windows –ü–ö —á–µ—Ä–µ–∑ SSH. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç—Å—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π –∞—Ä–µ–Ω–¥—ã Drova.io.

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

```
 Drova API (services.drova.io)
        ‚îÇ  polling / webhook
        ‚ñº
 [ Linux –≤–æ—Ä–∫–µ—Ä ]  ‚îÄ‚îÄSSH‚îÄ‚îÄ‚ñ∫  [ Windows –∏–≥—Ä–æ–≤–æ–π –ü–ö ]
  drova_poll / drova_socket      SSH + PsExec + Shadow Defender
```

**–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª –æ–¥–Ω–æ–π —Å–µ—Å—Å–∏–∏ –∞—Ä–µ–Ω–¥—ã:**

1. –í–æ—Ä–∫–µ—Ä —Å—Ç–∞—Ä—Ç—É–µ—Ç ‚Üí –∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É (–ø—Ä–æ–≤–µ—Ä—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, —á–∏—Å—Ç–∏—Ç —Ä–µ–µ—Å—Ç—Ä)
2. –ñ–¥—ë—Ç –ø–æ—è–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏ –≤ Drova API —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º `NEW/HANDSHAKE/ACTIVE`
3. `BeforeConnect`: –≤—Ö–æ–¥–∏—Ç –≤ Shadow Defender, –ø—Ä–∏–º–µ–Ω—è–µ—Ç —Ä–µ–µ—Å—Ç—Ä–æ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç explorer.exe
4. `WaitFinishOrAbort`: polling Drova API ‚Äî –∂–¥—ë—Ç —Å—Ç–∞—Ç—É—Å–∞ `FINISHED/ABORTED`
5. `AfterDisconnect`: –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ Shadow Defender + –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –ü–ö (–æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

### –î–≤–∞ —Ä–µ–∂–∏–º–∞ —Ä–∞–±–æ—Ç—ã

| –†–µ–∂–∏–º | –ö–æ–º–∞–Ω–¥–∞ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|---|---|---|
| **poll** | `drova_poll` | –û—Å–Ω–æ–≤–Ω–æ–π. –°–∞–º –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç API –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É |
| **socket** | `drova_socket` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π. –°–ª—É—à–∞–µ—Ç TCP-–ø–æ—Ä—Ç, –∂–¥—ë—Ç –≤–Ω–µ—à–Ω–µ–≥–æ —Ç—Ä–∏–≥–≥–µ—Ä–∞ |

---

## 2. –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

### Linux-–º–∞—à–∏–Ω–∞ (–≤–æ—Ä–∫–µ—Ä)

- **–û–°:** Ubuntu 22.04 LTS / 24.04 LTS (–∏–ª–∏ –¥—Ä—É–≥–æ–π Linux —Å Python 3.11+)
- **Python:** 3.11 –∏–ª–∏ –Ω–æ–≤–µ–µ (`python3.11 --version`)
- **Poetry:** –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- **–°–µ—Ç—å:** –∏—Å—Ö–æ–¥—è—â–∏–π –¥–æ—Å—Ç—É–ø –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç –∫ `services.drova.io` (HTTPS/443)
- **–°–µ—Ç—å:** –¥–æ—Å—Ç—É–ø –∫ Windows –ü–ö –ø–æ –ø–æ—Ä—Ç–∞–º **22** (SSH) –∏ **7985** (Drova binary protocol)

–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è Python 3.11 –Ω–∞ Ubuntu:

```bash
python3.11 --version 2>/dev/null || echo "–ù—É–∂–Ω–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∞: sudo apt install python3.11"
```

### Windows –ü–ö (–∏–≥—Ä–æ–≤–æ–π)

- –í–∫–ª—é—á—ë–Ω –∏ –¥–æ—Å—Ç—É–ø–µ–Ω SSH-—Å–µ—Ä–≤–µ—Ä (OpenSSH Server)
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **PsExec** (–∏–∑ Sysinternals Suite), –¥–æ—Å—Ç—É–ø–µ–Ω –≤ `PATH`
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω **Shadow Defender** (`C:\Program Files\Shadow Defender\CmdTool.exe`)
- –ü–ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∫–∞–∫ —Å–µ—Ä–≤–µ—Ä –≤ –ª–∏—á–Ω–æ–º –∫–∞–±–∏–Ω–µ—Ç–µ Drova.io
- ESME-–∞–≥–µ–Ω—Ç Drova –∑–∞–ø—É—â–µ–Ω –∏ —Å–æ–∑–¥–∞–ª –∫–ª—é—á–∏ –≤ —Ä–µ–µ—Å—Ç—Ä–µ:
  `HKEY_LOCAL_MACHINE\SOFTWARE\ITKey\Esme\servers\<server_id>`

---

## 3. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ

### 3.0 –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –Ω–∞ Ubuntu (–ø–æ—à–∞–≥–æ–≤—ã–π –≥–∞–π–¥)

–†–∞–∑–¥–µ–ª –¥–ª—è —á–∏—Å—Ç–æ–π Ubuntu 22.04 / 24.04. –ï—Å–ª–∏ —É –≤–∞—Å –¥—Ä—É–≥–æ–π –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ä–∞–∑–¥–µ–ª—ã 3.1‚Äì3.3.

#### 3.0.1 –°–∏—Å—Ç–µ–º–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
sudo apt update
sudo apt install -y \
    python3.11 python3.11-venv python3-pip \
    git curl
```

–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤–µ—Ä—Å–∏—é Python:

```bash
python3.11 --version   # –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å Python 3.11.x –∏–ª–∏ –≤—ã—à–µ
```

#### 3.0.2 –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏

–í–æ—Ä–∫–µ—Ä –ª—É—á—à–µ –∑–∞–ø—É—Å–∫–∞—Ç—å –æ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –Ω–µ–ø—Ä–∏–≤–∏–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:

```bash
# –°–æ–∑–¥–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –±–µ–∑ shell-–≤—Ö–æ–¥–∞:
sudo useradd -r -m -d /opt/drova -s /usr/sbin/nologin drova

# –°–æ–∑–¥–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞:
sudo mkdir -p /opt/drova/app
sudo chown -R drova:drova /opt/drova
```

#### 3.0.3 –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è drova:
sudo -u drova bash

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
git clone https://github.com/AALagutin/DrovaKeeneticDesktop_fork1.git /opt/drova/app
cd /opt/drova/app
git checkout claude/review-drova-keenetic-fork-qjpRj

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Poetry (–≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è drova):
curl -sSL https://install.python-poetry.org | python3.11 -

# –î–æ–±–∞–≤–∏—Ç—å Poetry –≤ PATH —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏:
export PATH="/opt/drova/.local/bin:$PATH"

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ venv:
poetry install --without dev

# –í—ã–π—Ç–∏ –∏–∑ sudo -u drova
exit
```

–ü—É—Ç—å –∫ —Å–æ–∑–¥–∞–Ω–Ω–æ–º—É venv:

```bash
sudo -u drova bash -c "cd /opt/drova/app && poetry env info --path"
# –ü—Ä–∏–º–µ—Ä: /opt/drova/.cache/pypoetry/virtualenvs/drova-keenetic-desktop-xxxx/
```

#### 3.0.4 –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –°–æ–∑–¥–∞—Ç—å –∑–∞—â–∏—â—ë–Ω–Ω—ã–π —Ñ–∞–π–ª .env (—Ç–æ–ª—å–∫–æ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è drova):
sudo -u drova bash -c "cat > /opt/drova/app/.env" << 'EOF'
WINDOWS_HOST=192.168.1.100
WINDOWS_LOGIN=Administrator
WINDOWS_PASSWORD=YourWindowsPassword
SHADOW_DEFENDER_PASSWORD=YourSDPassword
SHADOW_DEFENDER_DRIVES=C
EOF

sudo chmod 600 /opt/drova/app/.env
```

#### 3.0.5 –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

```bash
sudo -u drova bash -c "cd /opt/drova/app && poetry run drova_validate"
```

---

### 3.1 –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–æ–±—â–∏–π —Å–ª—É—á–∞–π)

```bash
git clone https://github.com/AALagutin/DrovaKeeneticDesktop_fork1.git
cd DrovaKeeneticDesktop_fork1

# –†–∞–±–æ—á–∞—è –≤–µ—Ç–∫–∞:
git checkout claude/review-drova-keenetic-fork-qjpRj
```

### 3.2 –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Poetry –µ—Å–ª–∏ –Ω–µ—Ç:
curl -sSL https://install.python-poetry.org | python3 -

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞:
poetry install
```

### 3.3 –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
cp .env.example .env   # –µ—Å–ª–∏ –µ—Å—Ç—å —à–∞–±–ª–æ–Ω
# –∏–ª–∏ —Å–æ–∑–¥–∞—Ç—å –≤—Ä—É—á–Ω—É—é:
nano .env
```

–§–∞–π–ª `.env` —Ä–∞–∑–º–µ—â–∞–µ—Ç—Å—è –≤ –∫–æ—Ä–Ω–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è. –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ `python-dotenv`.

–ü—É—Ç—å –∫ `.env` –º–æ–∂–Ω–æ –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π `ENV_LOCATION`:

```bash
ENV_LOCATION=/etc/drova/production.env drova_poll
```

---

## 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### 4.1 –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`.env`)

#### –†–µ–∂–∏–º single-host (–æ–¥–∏–Ω –ü–ö)

```ini
# –ò–≥—Ä–æ–≤–æ–π Windows –ü–ö
WINDOWS_HOST=192.168.1.100
WINDOWS_LOGIN=Administrator
WINDOWS_PASSWORD=YourWindowsPassword

# Shadow Defender
SHADOW_DEFENDER_PASSWORD=YourSDPassword
SHADOW_DEFENDER_DRIVES=C          # –¥–∏—Å–∫–∏ —á–µ—Ä–µ–∑ –ø—Ä–æ–±–µ–ª: "C D E"

# –¢–æ–ª—å–∫–æ –¥–ª—è drova_socket
DROVA_SOCKET_LISTEN=7985
```

#### –†–µ–∂–∏–º multi-host (–Ω–µ—Å–∫–æ–ª—å–∫–æ –ü–ö)

–í–º–µ—Å—Ç–æ `.env` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è JSON-—Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```ini
# –í .env —Ç–æ–ª—å–∫–æ –ø—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É:
DROVA_CONFIG=/etc/drova/hosts.json
```

> `SHADOW_DEFENDER_PASSWORD` –∏ `SHADOW_DEFENDER_DRIVES` –≤ multi-host —Ä–µ–∂–∏–º–µ —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è **–≤ —Å–∞–º–æ–º –∫–æ–Ω—Ñ–∏–≥–µ** –≤ —Å–µ–∫—Ü–∏–∏ `defaults` (`shadow_defender_password` / `shadow_defender_drives`) ‚Äî –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –∏—Ö –≤ `.env` –Ω–µ –Ω—É–∂–Ω–æ.

**–§–æ—Ä–º–∞—Ç `/etc/drova/hosts.json`:**

```json
{
  "defaults": {
    "login": "Administrator",
    "password": "CommonPassword",
    "shadow_defender_password": "SDPassword",
    "shadow_defender_drives": "C"
  },
  "hosts": [
    {
      "host": "192.168.1.100"
    },
    {
      "host": "192.168.1.101",
      "login": "OtherUser",
      "password": "OtherPass"
    },
    {
      "host": "192.168.1.102",
      "login": "Admin3",
      "password": "Pass3"
    }
  ]
}
```

–í multi-host —Ä–µ–∂–∏–º–µ –≤–æ—Ä–∫–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç –æ—Ç–¥–µ–ª—å–Ω—ã–π `DrovaPoll` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ü–ö, –≤—Å–µ —Ä–∞–±–æ—Ç–∞—é—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —á–µ—Ä–µ–∑ `asyncio.gather`.

### 4.2 –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ç–µ–Ω–µ–π Shadow Defender

`SHADOW_DEFENDER_DRIVES` ‚Äî —Å—Ç—Ä–æ–∫–∞ —Å –±—É–∫–≤–∞–º–∏ –¥–∏—Å–∫–æ–≤ –±–µ–∑ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª–µ–π:

```ini
SHADOW_DEFENDER_DRIVES=C          # —Ç–æ–ª—å–∫–æ –¥–∏—Å–∫ C
SHADOW_DEFENDER_DRIVES=CD         # –¥–∏—Å–∫–∏ C –∏ D
SHADOW_DEFENDER_DRIVES=CDE        # –¥–∏—Å–∫–∏ C, D –∏ E
```

### 4.3 –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –Ω–∞ Windows –ü–ö

–ù–∞ Windows –ü–ö –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω OpenSSH Server:

```powershell
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å (PowerShell –æ—Ç –∏–º–µ–Ω–∏ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞):
Add-WindowsCapability -Online -Name OpenSSH.Server~~~~0.0.1.0
Start-Service sshd
Set-Service -Name sshd -StartupType Automatic
```

–£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑ `WINDOWS_LOGIN` –º–æ–∂–µ—Ç –≤–æ–π—Ç–∏ –ø–æ SSH —Å –ø–∞—Ä–æ–ª–µ–º `WINDOWS_PASSWORD`.

---

## 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

–ü–µ—Ä–µ–¥ –ø–µ—Ä–≤—ã–º –∑–∞–ø—É—Å–∫–æ–º –≤–æ—Ä–∫–µ—Ä–∞ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å—ë —Å –ø–æ–º–æ—â—å—é –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π —É—Ç–∏–ª–∏—Ç—ã:

```bash
poetry run drova_validate
```

–ö–æ–º–∞–Ω–¥–∞ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
1. –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `.env`
2. SSH-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Windows –ü–ö
3. –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Shadow Defender CLI –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è
4. –†–∞–±–æ—Ç—É SFTP (—Å–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª —Å –ü–ö)
5. –†–∞–±–æ—Ç—É PsExec

**–ü—Ä–∏–º–µ—Ä —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–≤–æ–¥–∞:**
```
/path/to/project/.env
Windows access complete!
Shadow Defender list is ok!
sftp open
```

**–ü—Ä–∏ –æ—à–∏–±–∫–µ** –∫–æ–º–∞–Ω–¥–∞ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è —Å –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º –∏ —Å—Ç–µ–∫—Ç—Ä–µ–π—Å–æ–º ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç.

---

## 6. –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

### 6.1 Polling-—Ä–µ–∂–∏–º (–æ—Å–Ω–æ–≤–Ω–æ–π)

```bash
# –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å venv –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å:
poetry run drova_poll
```

–ò–ª–∏ —á–µ—Ä–µ–∑ Python –Ω–∞–ø—Ä—è–º—É—é:

```bash
poetry run python -m drova_desktop_keenetic.bin.drova_poll
```

–í–æ—Ä–∫–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è, –≤—ã–≤–æ–¥–∏—Ç –ª–æ–≥–∏ –≤ –∫–æ–Ω—Å–æ–ª—å –∏ –≤ —Ñ–∞–π–ª `app.log` (—Ä–æ—Ç–∏—Ä—É–µ–º—ã–π, 1 –ú–ë √ó 5 —Ñ–∞–π–ª–æ–≤).

**–û—Å—Ç–∞–Ω–æ–≤–∫–∞:** `Ctrl+C`

### 6.2 Socket-—Ä–µ–∂–∏–º

```bash
poetry run drova_socket
```

–í–æ—Ä–∫–µ—Ä —Å–ª—É—à–∞–µ—Ç –ø–æ—Ä—Ç `DROVA_SOCKET_LISTEN`. –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ (Drova Router) ‚Äî –ø—Ä–æ–∫—Å–∏—Ä—É–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –Ω–∞ –ø–æ—Ä—Ç 7985 Windows –ü–ö –∏ –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É —Å–µ—Å—Å–∏–∏.

### 6.3 –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º `.env`

```bash
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:
ENV_LOCATION=/etc/drova/hosts.json poetry run drova_poll

# –ò–ª–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é:
WINDOWS_HOST=192.168.1.200 \
WINDOWS_LOGIN=user \
WINDOWS_PASSWORD=pass \
SHADOW_DEFENDER_PASSWORD=sdpass \
SHADOW_DEFENDER_DRIVES=C \
poetry run drova_poll
```

### 6.4 –ü–æ–≤—ã—à–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

–£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `bin/__init__.py` –∫–∞–∫ `INFO`. –î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∫–æ–¥–∞:

```bash
# –ß–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è Python logging:
PYTHONPATH=. poetry run python -c "
import logging
logging.basicConfig(level=logging.DEBUG)
from drova_desktop_keenetic.bin.drova_poll import run_async_main
run_async_main()
"
```

---

## 7. –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫

### 7.1 systemd –Ω–∞ Ubuntu (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

#### –£–∑–Ω–∞—Ç—å –ø—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É drova_poll

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ —á–µ—Ä–µ–∑ Poetry –ø—É—Ç—å –∑–∞–≤–∏—Å–∏—Ç –æ—Ç venv. –ü–æ–ª—É—á–∏—Ç—å –µ–≥–æ:

```bash
sudo -u drova bash -c "cd /opt/drova/app && poetry run which drova_poll"
# –ü—Ä–∏–º–µ—Ä –≤—ã–≤–æ–¥–∞:
# /opt/drova/.cache/pypoetry/virtualenvs/drova-keenetic-desktop-AbCdEf-py3.11/bin/drova_poll
```

–ó–∞–ø–æ–º–Ω–∏—Ç–µ —ç—Ç–æ—Ç –ø—É—Ç—å ‚Äî –æ–Ω –Ω—É–∂–µ–Ω –≤ unit-—Ñ–∞–π–ª–µ.

#### –°–æ–∑–¥–∞—Ç—å unit-—Ñ–∞–π–ª

```bash
sudo nano /etc/systemd/system/drova-poll.service
```

**–°–æ–¥–µ—Ä–∂–∏–º–æ–µ** (–ø–æ–¥—Å—Ç–∞–≤—å—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π –ø—É—Ç—å –∫ `drova_poll`):

```ini
[Unit]
Description=DrovaKeenetic Poll Worker
After=network-online.target
Wants=network-online.target

[Service]
Type=simple
User=drova
Group=drova
WorkingDirectory=/opt/drova/app

# –ü—É—Ç—å –∫ –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–º—É —Ñ–∞–π–ª—É –∏–∑ venv Poetry:
ExecStart=/opt/drova/.cache/pypoetry/virtualenvs/drova-keenetic-desktop-AbCdEf-py3.11/bin/drova_poll

Restart=always
RestartSec=10

# –õ–æ–≥–∏ –∏–¥—É—Ç –≤ journald (–ø—Ä–æ—Å–º–æ—Ç—Ä: journalctl -u drova-poll -f)
StandardOutput=journal
StandardError=journal

# –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –≤–º–µ—Å—Ç–æ .env-—Ñ–∞–π–ª–∞ –≤ –ø—Ä–æ–µ–∫—Ç–µ ‚Äî —É–∫–∞–∑–∞—Ç—å –≤–Ω–µ—à–Ω–∏–π —Ñ–∞–π–ª:
# EnvironmentFile=/etc/drova/drova.env

[Install]
WantedBy=multi-user.target
```

> **–°–æ–≤–µ—Ç:** –ß—Ç–æ–±—ã –Ω–µ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —Ö–µ—à–∞ venv, –º–æ–∂–Ω–æ –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –ø—É—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–∞–ø–ø–µ—Ä:
>
> ```bash
> sudo -u drova bash -c "cat > /opt/drova/run_poll.sh" << 'EOF'
> #!/bin/bash
> cd /opt/drova/app
> exec poetry run drova_poll
> EOF
> sudo chmod +x /opt/drova/run_poll.sh
> ```
>
> –ò –≤ unit-—Ñ–∞–π–ª–µ: `ExecStart=/opt/drova/run_poll.sh`

#### –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

```bash
# –ü—Ä–∏–º–µ–Ω–∏—Ç—å unit-—Ñ–∞–π–ª:
sudo systemctl daemon-reload
sudo systemctl enable drova-poll    # –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
sudo systemctl start drova-poll     # –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ–π—á–∞—Å

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ:
sudo systemctl status drova-poll    # —Å—Ç–∞—Ç—É—Å (PID, uptime, –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –ª–æ–≥–∞)
sudo systemctl restart drova-poll   # –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫
sudo systemctl stop drova-poll      # –æ—Å—Ç–∞–Ω–æ–≤–∫–∞

# –õ–æ–≥–∏:
sudo journalctl -u drova-poll -f                    # –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
sudo journalctl -u drova-poll --since "1 hour ago"  # –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–π —á–∞—Å
sudo journalctl -u drova-poll --since today         # –∑–∞ —Å–µ–≥–æ–¥–Ω—è
sudo journalctl -u drova-poll -n 100                # –ø–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å—Ç—Ä–æ–∫
```

### 7.2 Multi-host —á–µ—Ä–µ–∑ systemd –Ω–∞ Ubuntu

–î–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ü–ö ‚Äî –æ–¥–∏–Ω –≤–æ—Ä–∫–µ—Ä —Å `DROVA_CONFIG`. –†–∞–∑–º–µ—Å—Ç–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥:

```bash
sudo mkdir -p /etc/drova
sudo -u drova bash -c "cat > /etc/drova/hosts.json" << 'EOF'
{
  "defaults": { "login": "Administrator", "password": "pass",
                "shadow_defender_password": "sdpass", "shadow_defender_drives": "C" },
  "hosts": [
    { "host": "192.168.1.100" },
    { "host": "192.168.1.101" }
  ]
}
EOF
sudo chmod 640 /etc/drova/hosts.json
```

–í unit-—Ñ–∞–π–ª–µ –¥–æ–±–∞–≤–∏—Ç—å:

```ini
[Service]
Environment=DROVA_CONFIG=/etc/drova/hosts.json
```

### 7.3 –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞ OpenWRT / Keenetic (init.d)

```bash
cat > /etc/init.d/drova_poll << 'EOF'
#!/bin/sh /etc/rc.common

START=99
STOP=10
USE_PROCD=1

start_service() {
    procd_open_instance
    procd_set_param command /opt/drova/.venv/bin/drova_poll
    procd_set_param env WINDOWS_HOST=192.168.1.100 \
        WINDOWS_LOGIN=Administrator \
        WINDOWS_PASSWORD=yourpass \
        SHADOW_DEFENDER_PASSWORD=sdpass \
        SHADOW_DEFENDER_DRIVES=C
    procd_set_param respawn 3600 5 0
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
}
EOF

chmod +x /etc/init.d/drova_poll
/etc/init.d/drova_poll enable
/etc/init.d/drova_poll start
```

### 7.4 Web-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ö–æ—Å—Ç–∞–º–∏ (drova_web)

`drova_web` ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤–æ—Ä–∫–µ—Ä—ã –∫–∞–∫ –¥–æ—á–µ—Ä–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –±—Ä–∞—É–∑–µ—Ä–Ω—ã–π UI –¥–ª—è –∏—Ö —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∏–∑ —Ç–æ–π –∂–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏, —á—Ç–æ –∏ multi-host `drova_poll`.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:** `DROVA_CONFIG` ‚Äî –ø—É—Ç—å –∫ JSON-–∫–æ–Ω—Ñ–∏–≥—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏ —Ö–æ—Å—Ç–∞–º–∏ (—Å–º. 7.2).

#### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `DROVA_CONFIG` | ‚Äî | **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ.** –ü—É—Ç—å –∫ JSON-–∫–æ–Ω—Ñ–∏–≥—É (–∏–º—è —Ñ–∞–π–ª–∞ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–µ: `hosts.json`, `config.json` –∏ —Ç.–¥.) |
| `DROVA_WEB_PORT` | `8080` | –ü–æ—Ä—Ç HTTP |
| `DROVA_WEB_USER` | `admin` | –õ–æ–≥–∏–Ω –¥–ª—è Basic Auth |
| `DROVA_WEB_PASSWORD` | ‚Äî | –ü–∞—Ä–æ–ª—å (–µ—Å–ª–∏ –Ω–µ –∑–∞–¥–∞–Ω ‚Äî UI –æ—Ç–∫—Ä—ã—Ç –≤—Å–µ–º!) |

> `SHADOW_DEFENDER_PASSWORD` –∏ `SHADOW_DEFENDER_DRIVES` **–Ω–µ –Ω—É–∂–Ω—ã** –≤ `web.env`. `drova_web` —á–∏—Ç–∞–µ—Ç –∏—Ö –∏–∑ —Å–µ–∫—Ü–∏–∏ `defaults` –∫–æ–Ω—Ñ–∏–≥–∞ (–∫–ª—é—á–∏ `shadow_defender_password` / `shadow_defender_drives`) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞—ë—Ç –¥–æ—á–µ—Ä–Ω–∏–º –≤–æ—Ä–∫–µ—Ä–∞–º.

#### –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
sudo bash -c "cat > /opt/drova-desktop/web.env" << 'EOF'
DROVA_CONFIG=/etc/drova/hosts.json
DROVA_WEB_PORT=8080
DROVA_WEB_USER=admin
DROVA_WEB_PASSWORD=your_strong_password
EOF
sudo chmod 600 /opt/drova-desktop/web.env
```

> `SHADOW_DEFENDER_PASSWORD` –∏ `SHADOW_DEFENDER_DRIVES` —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ –ø–æ–¥ –∫–ª—é—á–∞–º–∏ `shadow_defender_password` / `shadow_defender_drives` –≤ —Å–µ–∫—Ü–∏–∏ `defaults` ‚Äî –≤ `web.env` –∏—Ö —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–µ –Ω—É–∂–Ω–æ.

#### –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å systemd-—Å–µ—Ä–≤–∏—Å

```bash
sudo cp systemd/drova_web.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable drova_web
sudo systemctl start drova_web
```

#### –û—Ç–∫—Ä—ã—Ç—å UI

```
http://<ip-—Å–µ—Ä–≤–µ—Ä–∞>:8080
```

–ë—Ä–∞—É–∑–µ—Ä –∑–∞–ø—Ä–æ—Å–∏—Ç Basic Auth (–ª–æ–≥–∏–Ω/–ø–∞—Ä–æ–ª—å –∏–∑ `DROVA_WEB_USER` / `DROVA_WEB_PASSWORD`).

---

#### –¢–∞–±–ª–∏—Ü–∞ —Ö–æ—Å—Ç–æ–≤ ‚Äî –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–ª–æ–Ω–æ–∫

UI –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—É —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–æ–ª–æ–Ω–∫–∞–º–∏:

| –ö–æ–ª–æ–Ω–∫–∞ | –ß—Ç–æ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç |
|---|---|
| **–•–æ—Å—Ç** | IP-–∞–¥—Ä–µ—Å –∏–ª–∏ –∏–º—è Windows –ü–ö |
| **–í–æ—Ä–∫–µ—Ä** | –°—Ç–∞—Ç—É—Å –¥–æ—á–µ—Ä–Ω–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞: `–†–∞–±–æ—Ç–∞–µ—Ç` / `–û—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω` / `–û—Ç–∫–ª—é—á—ë–Ω` / `–û—à–∏–±–∫–∞` |
| **SSH** | –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ SSH-–∑–æ–Ω–¥–∞: ‚úì = –¥–æ—Å—Ç—É–ø–µ–Ω –∏ –ø–∞—Ä–æ–ª—å –≤–µ—Ä–Ω—ã–π; ‚úó = –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å; ? = –µ—â—ë –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª—Å—è |
| **SD** | Shadow Defender: üîí = —Ö–æ—Ç—è –±—ã –æ–¥–∏–Ω –¥–∏—Å–∫ –≤ —Ç–µ–Ω–µ–≤–æ–º —Ä–µ–∂–∏–º–µ; üîì = —Ç–µ–Ω–µ–≤–æ–π —Ä–µ–∂–∏–º –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω; ? = –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö |
| **–û–≥—Ä.** | –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ä–µ–µ—Å—Ç—Ä–∞: ‚úì = –≤—Å–µ –∫–ª—é—á–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç; ‚úó –∫—Ä–∞—Å–Ω—ã–π = SD –∞–∫—Ç–∏–≤–µ–Ω, –Ω–æ –∫–ª—é—á–µ–π –Ω–µ—Ç (–ø—Ä–æ–±–ª–µ–º–∞!); ‚úó –∂—ë–ª—Ç—ã–π = SD –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω, –∫–ª—é—á–µ–π –Ω–µ—Ç (–æ–∂–∏–¥–∞–µ–º–æ –¥–ª—è –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—â–µ–≥–æ –ü–ö); ? = –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö |
| **–°–µ—Å—Å–∏—è** | –¢–µ–∫—É—â–∏–π Drova-—Å–µ–∞–Ω—Å: üñ• = –∞–∫—Ç–∏–≤–Ω—ã–π —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª; ‚ñ∑ = –∞–∫—Ç–∏–≤–Ω—ã–π —Å–µ–∞–Ω—Å, –Ω–æ –Ω–µ —Ä–∞–±–æ—á–∏–π —Å—Ç–æ–ª; ‚óã = –Ω–µ—Ç —Å–µ–∞–Ω—Å–∞; ? = –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö |
| **–î–∏–∞–≥–Ω.‚Üë** | –†–µ–∑—É–ª—å—Ç–∞—Ç —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (—Å–º. –Ω–∏–∂–µ) |
| **PID** | PID –¥–æ—á–µ—Ä–Ω–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ –≤–æ—Ä–∫–µ—Ä–∞ |
| **–î–µ–π—Å—Ç–≤–∏—è** | –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (—Å–º. –Ω–∏–∂–µ) |

–ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –∏–∫–æ–Ω–∫—É SSH/SD/–û–≥—Ä./–°–µ—Å—Å–∏—è ‚Äî –ø–æ–∫–∞–∂–µ—Ç—Å—è tooltip —Å –≤—Ä–µ–º–µ–Ω–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–π –ø—Ä–æ–≤–µ—Ä–∫–∏. –¢–∞–±–ª–∏—Ü–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—ã–µ 3 —Å–µ–∫—É–Ω–¥—ã.

---

#### –ö–æ–ª–æ–Ω–∫–∞ ¬´–î–∏–∞–≥–Ω.‚Üë¬ª ‚Äî —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –≤–æ—Ä–∫–µ—Ä–∞ `GamePCDiagnostic` –≤—Ö–æ–¥–∏—Ç –≤ Shadow Defender, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ —Ä–µ–µ—Å—Ç—Ä–æ–≤—ã–µ –ø–∞—Ç—á–∏, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏—Ö, –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ SD + –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç –ü–ö. –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ JSON-—Ñ–∞–π–ª (`/tmp/drova-status-<host>.json`) –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ UI:

| –ò–∫–æ–Ω–∫–∞ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| `‚Äî` —Å–µ—Ä—ã–π | –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª–∞—Å—å —Å –º–æ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –≤–æ—Ä–∫–µ—Ä–∞ |
| `‚äô` —Å–∏–Ω–∏–π | –ü—Ä–æ–ø—É—â–µ–Ω–∞: –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞ –∞–∫—Ç–∏–≤–Ω–∞—è Drova-—Å–µ—Å—Å–∏—è (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ) |
| `‚ö°` –∫—Ä–∞—Å–Ω—ã–π | –ü—Ä–µ—Ä–≤–∞–Ω–∞: –æ—à–∏–±–∫–∞ –∏–ª–∏ `RebootRequired` (–ü–ö –µ—â—ë –Ω–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ ESME) |
| `‚úì 28/28` –∑–µ–ª—ë–Ω—ã–π | –í—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã, –ø–∞—Ç—á–∏ –±–µ–∑ –æ—à–∏–±–æ–∫ |
| `‚ö† N/28` –∂—ë–ª—Ç—ã–π | –ß–∞—Å—Ç—å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∞—Å—å –∏–ª–∏ –ø–∞—Ç—á —É–ø–∞–ª —Å –æ—à–∏–±–∫–æ–π |

–ù–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –∏–∫–æ–Ω–∫—É ‚Äî tooltip –ø–æ–∫–∞–∂–µ—Ç: –≤—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞, —Å–ø–∏—Å–æ–∫ –Ω–µ–∑–∞–∫—Ä—ã—Ç—ã—Ö –∫–ª—é—á–µ–π —Ä–µ–µ—Å—Ç—Ä–∞, –∏–º–µ–Ω–∞ —É–ø–∞–≤—à–∏—Ö –ø–∞—Ç—á–µ–π.

> **–í–∞–∂–Ω–æ:** –ó–Ω–∞—á–µ–Ω–∏–µ `‚Äî` –ø–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –∫–Ω–æ–ø–∫—É ¬´–°—Ç–æ–ø ‚Üí –°—Ç–∞—Ä—Ç¬ª –≤ UI) ‚Äî —à—Ç–∞—Ç–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –∏ –∏–∫–æ–Ω–∫–∞ –æ–±–Ω–æ–≤–∏—Ç—Å—è —á–µ—Ä–µ–∑ –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç.

---

#### –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π

| –ö–Ω–æ–ø–∫–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|---|---|
| **–°—Ç–∞—Ä—Ç** | –ó–∞–ø—É—Å–∫–∞–µ—Ç –¥–æ—á–µ—Ä–Ω–∏–π –ø—Ä–æ—Ü–µ—Å—Å –≤–æ—Ä–∫–µ—Ä–∞ –¥–ª—è —ç—Ç–æ–≥–æ —Ö–æ—Å—Ç–∞ |
| **–°—Ç–æ–ø** | –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–æ—Ä–∫–µ—Ä (graceful `SIGTERM`), –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç `"enabled": false` –≤ `hosts.json` |
| **‚Ü∫** (–ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å) | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `shutdown /r /t 0 /f` –Ω–∞ Windows –ü–ö —á–µ—Ä–µ–∑ SSH (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º) |
| **‚èª** (–í—ã–∫–ª—é—á–∏—Ç—å) | –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `shutdown /s /t 0 /f` –Ω–∞ Windows –ü–ö —á–µ—Ä–µ–∑ SSH (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º) |
| **‚úï** (–£–¥–∞–ª–∏—Ç—å) | –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –≤–æ—Ä–∫–µ—Ä –∏ —É–¥–∞–ª—è–µ—Ç —Ö–æ—Å—Ç –∏–∑ `hosts.json` (—Å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ–º) |

> **–ö–Ω–æ–ø–∫–∏ ‚Ü∫ –∏ ‚èª** —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ç–æ–≥–æ, –∑–∞–ø—É—â–µ–Ω –ª–∏ –≤–æ—Ä–∫–µ—Ä ‚Äî –æ–Ω–∏ –Ω–∞–ø—Ä—è–º—É—é —Å–æ–µ–¥–∏–Ω—è—é—Ç—Å—è —Å Windows –ü–ö –ø–æ SSH. –ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ –≤–æ—Ä–∫–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è.

---

#### –§–æ–Ω–æ–≤—ã–π SSH-–∑–æ–Ω–¥

–°–µ—Ä–≤–∏—Å `drova_web` –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –≤–æ—Ä–∫–µ—Ä–∞–º–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç —Ñ–æ–Ω–æ–≤—ã–µ SSH-–ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫—É–Ω–¥ (–ø–µ—Ä–≤—ã–π –ø—Ä–æ–≥–æ–Ω —á–µ—Ä–µ–∑ 15 —Å–µ–∫—É–Ω–¥ –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞). –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ö–æ—Å—Ç–∞ –∑–æ–Ω–¥:

1. –ü—Ä–æ–±—É–µ—Ç SSH-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º–∏ —É—á—ë—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç **SSH**
2. –í—ã–ø–æ–ª–Ω—è–µ—Ç `ShadowDefenderCLI /list` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç **SD**
3. –î–µ–ª–∞–µ—Ç `reg query` –¥–ª—è –≤—Å–µ—Ö ~28 –∫–ª—é—á–µ–π `PatchWindowsSettings` ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç **–û–≥—Ä.**
4. –ß–∏—Ç–∞–µ—Ç `auth_token` –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞, –æ–ø—Ä–∞—à–∏–≤–∞–µ—Ç Drova API ‚Üí –æ–±–Ω–æ–≤–ª—è–µ—Ç **–°–µ—Å—Å–∏—è**

–ó–æ–Ω–¥ –ø–æ–ª–Ω–æ—Å—Ç—å—é read-only ‚Äî –æ–Ω –Ω–∏—á–µ–≥–æ –Ω–µ –º–µ–Ω—è–µ—Ç –Ω–∞ Windows –ü–ö. –ö–∞–∂–¥—ã–π —Ö–æ—Å—Ç –∑–æ–Ω–¥–∏—Ä—É–µ—Ç—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ —Å —Ç–∞–π–º–∞—É—Ç–æ–º 90 —Å–µ–∫—É–Ω–¥.

---

#### REST API

–í–µ–±-—Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API (–≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã —Ç—Ä–µ–±—É—é—Ç Basic Auth):

| –ú–µ—Ç–æ–¥ | Endpoint | –û–ø–∏—Å–∞–Ω–∏–µ |
|---|---|---|
| `GET` | `/api/hosts` | –°–ø–∏—Å–æ–∫ —Ö–æ—Å—Ç–æ–≤ —Å –ø–æ–ª–Ω—ã–º —Å—Ç–∞—Ç—É—Å–æ–º (–≤–æ—Ä–∫–µ—Ä + –∑–æ–Ω–¥ + —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞) |
| `POST` | `/api/hosts/{host}/start` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–∫–µ—Ä |
| `POST` | `/api/hosts/{host}/stop` | –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤–æ—Ä–∫–µ—Ä |
| `POST` | `/api/hosts/{host}/reboot` | –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å Windows –ü–ö |
| `POST` | `/api/hosts/{host}/shutdown` | –í—ã–∫–ª—é—á–∏—Ç—å Windows –ü–ö |
| `PUT` | `/api/hosts` | –î–æ–±–∞–≤–∏—Ç—å —Ö–æ—Å—Ç (—Ç–µ–ª–æ: `{"host":"...", "login":"...", "password":"..."}`) |
| `DELETE` | `/api/hosts/{host}` | –£–¥–∞–ª–∏—Ç—å —Ö–æ—Å—Ç |

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ `GET /api/hosts`:**

```json
[
  {
    "host": "192.168.1.100",
    "enabled": true,
    "running": true,
    "status": "running",
    "pid": 12345,
    "exit_code": null,
    "diag": {
      "ssh_ok": true,
      "shadow_mode": false,
      "restrictions_ok": false,
      "session_state": "idle",
      "last_checked": 1740655200.0
    },
    "worker_diag": {
      "timestamp": 1740655100.0,
      "skipped": false,
      "aborted": false,
      "patch_failures": [],
      "restrictions_ok": 28,
      "restrictions_total": 28,
      "restrictions_missing": []
    }
  }
]
```

`diag` ‚Äî –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ SSH-–∑–æ–Ω–¥–∞; `worker_diag` ‚Äî –¥–∞–Ω–Ω—ã–µ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏.

---

#### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–µ—Ä–≤–µ—Ä–∞

- systemd –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–µ—Ä–≤–∏—Å —Å `KillMode=control-group` ‚Üí –≤—Å–µ –¥–æ—á–µ—Ä–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä—ã —Ç–æ–∂–µ –∑–∞–≤–µ—Ä—à–∞—é—Ç—Å—è
- –ü—Ä–∏ —Å—Ç–∞—Ä—Ç–µ `drova_web` —á–∏—Ç–∞–µ—Ç `hosts.json` –∏ **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ —Ö–æ—Å—Ç—ã —Å `enabled: true`**
- –•–æ—Å—Ç—ã, –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ UI (–∫–Ω–æ–ø–∫–∞ ¬´–°—Ç–æ–ø¬ª), —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `hosts.json` –∫–∞–∫ `"enabled": false` –∏ **–Ω–µ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- –ï—Å–ª–∏ –≤–æ—Ä–∫–µ—Ä –ø–∞–¥–∞–µ—Ç –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–±–æ—Ç—ã, `drova_web` –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —ç—Ç–æ —á–µ—Ä–µ–∑ ~10 —Å–µ–∫—É–Ω–¥ –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç –µ–≥–æ
- –§–∞–π–ª—ã —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ (`/tmp/drova-status-*.json`) **–Ω–µ –æ—á–∏—â–∞—é—Ç—Å—è** –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ —Å–µ—Ä–≤–∏—Å–∞ ‚Äî –≤ UI –±—É–¥–µ—Ç –ø–æ–∫–∞–∑–∞–Ω–∞ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–µ–¥—ã–¥—É—â–µ–π —Å–µ—Å—Å–∏–∏ –¥–æ —Ç–µ—Ö –ø–æ—Ä, –ø–æ–∫–∞ –≤–æ—Ä–∫–µ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –∏ –Ω–µ –æ–±–Ω–æ–≤–∏—Ç —Ñ–∞–π–ª

#### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å

```bash
sudo systemctl status drova_web
sudo journalctl -u drova_web -f
```

---

### 7.5 supervisor

```ini
[program:drova_poll]
command=/opt/drova/.venv/bin/drova_poll
directory=/opt/drova/DrovaKeeneticDesktop_fork1
user=drova
autostart=true
autorestart=true
startsecs=5
startretries=3
stderr_logfile=/var/log/drova_poll.err
stdout_logfile=/var/log/drova_poll.out
environment=WINDOWS_HOST="192.168.1.100",WINDOWS_LOGIN="Administrator",WINDOWS_PASSWORD="yourpass",SHADOW_DEFENDER_PASSWORD="sdpass",SHADOW_DEFENDER_DRIVES="C"
```

```bash
supervisorctl reread
supervisorctl update
supervisorctl start drova_poll
```

---

## 8. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### 8.1 –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö unit-—Ç–µ—Å—Ç–æ–≤

```bash
poetry run pytest drova_desktop_keenetic/tests/ -v
```

### 8.2 –ó–∞–ø—É—Å–∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ç–µ—Å—Ç–∞

```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã qwinsta:
poetry run pytest drova_desktop_keenetic/tests/test_common.py -v -k "qwinsta"

# –¢–µ—Å—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ auth_code:
poetry run pytest drova_desktop_keenetic/tests/test_common.py::test_parse_RegQueryEsme -v

# –° –ø–æ–¥—Ä–æ–±–Ω—ã–º –≤—ã–≤–æ–¥–æ–º –ª–æ–≥–æ–≤:
poetry run pytest drova_desktop_keenetic/tests/ -v -s --log-cli-level=DEBUG
```

### 8.3 –ü–æ–∫—Ä—ã—Ç—ã–µ —Ç–µ—Å—Ç—ã

–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä:
```bash
poetry run pytest drova_desktop_keenetic/tests/ -v
# 107 passed
```

#### `test_common.py` ‚Äî –∫–æ–º–∞–Ω–¥—ã –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

| –¢–µ—Å—Ç | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç |
|---|---|
| `test_parse_PSExec` | –ü–∞—Ä—Å–∏–Ω–≥ stderr PsExec (EN –∏ RU Windows) |
| `test_parse_RegQueryEsme` | –ü–∞—Ä—Å–∏–Ω–≥ `auth_token` –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞ |
| `test_qwinsta_parse_active_session_*` | `QWinSta` ‚Äî EN/RU, bytes/str, –Ω–µ—Ç —Å–µ—Å—Å–∏–∏ |
| `test_parse_all_auth_codes` | –ù–µ—Å–∫–æ–ª—å–∫–æ `server_id` –≤ —Ä–µ–µ—Å—Ç—Ä–µ |
| `test_windows_shutdown_*` | `WindowsShutdown` ‚Äî –∫–ª—é—á–∏ `/r`, `/s`, `/f` |
| `test_write_status_*` | `GamePCDiagnostic._write_status`: JSON-—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ, no-op –±–µ–∑ env, skipped-—Å–ª—É—á–∞–π |

#### `test_web_manager.py` ‚Äî WorkerManager

| –ì—Ä—É–ø–ø–∞ | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç |
|---|---|
| `TestConfigLoad` | –ó–∞–≥—Ä—É–∑–∫–∞ config.json, defaults, enabled, –æ—à–∏–±–æ—á–Ω—ã–π JSON |
| `TestConfigSave` | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ, –∞—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å, –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å defaults |
| `TestStartWorker` | –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞, env-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (HOST/LOGIN/PASSWORD/`DROVA_STATUS_FILE`), –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å |
| `TestStopWorker` | Graceful stop, SIGKILL –ø–æ —Ç–∞–π–º–∞—É—Ç—É, `enabled: false` –≤ –∫–æ–Ω—Ñ–∏–≥–µ |
| `TestAddHost` | –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ö–æ—Å—Ç–∞, –¥—É–±–ª–∏–∫–∞—Ç ‚Üí ValueError |
| `TestRemoveHost` | –£–¥–∞–ª–µ–Ω–∏–µ —Ö–æ—Å—Ç–∞, –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π ‚Üí ValueError |
| `TestMonitorLoop` | –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —É–ø–∞–≤—à–µ–≥–æ –≤–æ—Ä–∫–µ—Ä–∞ —á–µ—Ä–µ–∑ ~10 —Å–µ–∫ |
| `TestGetStatus` | –°—Ç–∞—Ç—É—Å—ã `running/stopped/disabled/error`, PID, exit_code |
| `TestWorkerDiag` | `_status_file_path` (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏–∑–º, —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å), `_load_worker_diag` (—á—Ç–µ–Ω–∏–µ —Ñ–∞–π–ª–∞, –±–∏—Ç—ã–π JSON), `get_status` –≤–∫–ª—é—á–∞–µ—Ç `worker_diag`, `start_worker` –ø–µ—Ä–µ–¥–∞—ë—Ç `DROVA_STATUS_FILE` –≤ env |
| `TestConfigResilience` | –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å ‚Äî –æ—Ä–∏–≥–∏–Ω–∞–ª –Ω–µ –ø–æ—Ä—Ç–∏—Ç—Å—è –ø—Ä–∏ –æ—à–∏–±–∫–µ `json.dump` |

#### `test_web_server.py` ‚Äî HTTP API

| –ì—Ä—É–ø–ø–∞ | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç |
|---|---|
| `TestBasicAuth` | 401 –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞, 401 –ø—Ä–∏ –Ω–µ–≤–µ—Ä–Ω–æ–º –ø–∞—Ä–æ–ª–µ, 200 –ø—Ä–∏ –≤–µ—Ä–Ω–æ–º |
| `TestGetHosts` | GET `/api/hosts` ‚Äî —Å—Ç–∞—Ç—É—Å 200, JSON-–º–∞—Å—Å–∏–≤, –ø–æ–ª—è `host/status/pid` |
| `TestGetHostsDiag` | GET `/api/hosts` ‚Äî –ø–æ–ª–µ `diag` —Å SSH/SD/restrictions/session, null-–∑–Ω–∞—á–µ–Ω–∏—è |
| `TestStartStop` | POST `/start` –∏ `/stop` ‚Äî 200, –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–æ–≤ manager, 404 –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —Ö–æ—Å—Ç–∞ |
| `TestRebootHost` | POST `/reboot` ‚Äî 200, –≤—ã–∑–æ–≤ `reboot_host`, 404, —Ç—Ä–µ–±—É–µ—Ç Auth |
| `TestShutdownHost` | POST `/shutdown` ‚Äî 200, –≤—ã–∑–æ–≤ `shutdown_host`, 404, —Ç—Ä–µ–±—É–µ—Ç Auth |
| `TestAddHost` | PUT `/api/hosts` ‚Äî 200, 409 –¥—É–±–ª–∏–∫–∞—Ç, 400 –ø—É—Å—Ç–æ–π —Ö–æ—Å—Ç, –ø—É—Å—Ç–æ–π –ª–æ–≥–∏–Ω ‚Üí None |
| `TestDeleteHost` | DELETE `/api/hosts/{host}` ‚Äî 200, 404 |

### 8.4 –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```bash
# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞:
poetry run black drova_desktop_keenetic/
poetry run isort drova_desktop_keenetic/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤:
poetry run mypy drova_desktop_keenetic/
```

---

## 9. –û—Ç–ª–∞–¥–∫–∞ –∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### 9.1 –§–∞–π–ª –ª–æ–≥–æ–≤

–õ–æ–≥–∏ –ø–∏—à—É—Ç—Å—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ:
- **–í –∫–æ–Ω—Å–æ–ª—å** (stdout)
- **–í —Ñ–∞–π–ª** `app.log` –≤ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ (—Ä–æ—Ç–∞—Ü–∏—è: 1 –ú–ë, —Ö—Ä–∞–Ω–∏—Ç—Å—è 5 —Ñ–∞–π–ª–æ–≤)

–§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Å–∏:
```
[2026-02-27 12:34:56] [INFO] [drova_desktop_keenetic.common.drova_poll] worker: start host=192.168.1.100
```

### 9.2 –ö–ª—é—á–µ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ª–æ–≥–∞—Ö

| –°–æ–æ–±—â–µ–Ω–∏–µ | –ó–Ω–∞—á–µ–Ω–∏–µ |
|---|---|
| `worker: start host=X.X.X.X` | –í–æ—Ä–∫–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ –ü–ö |
| `diagnostic: start` | –ù–∞—á–∞–ª–∞—Å—å —Å—Ç–∞—Ä—Ç–æ–≤–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ |
| `cleanup: N server registrations found` | –ù–∞–π–¥–µ–Ω–æ N –∑–∞–ø–∏—Å–µ–π –≤ —Ä–µ–µ—Å—Ç—Ä–µ ‚Äî –∏–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ |
| `cleanup: XXXX... ‚Äî invalid, deleting` | –£–¥–∞–ª–µ–Ω–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–∞—è –∑–∞–ø–∏—Å—å —Ä–µ–µ—Å—Ç—Ä–∞ |
| `sessions: active (ACTIVE) ‚Äî diagnostic skipped` | –ï—Å—Ç—å –∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Å—Å–∏—è ‚Äî –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞ |
| `SD enter: OK` | Shadow Defender —É—Å–ø–µ—à–Ω–æ –≤–∫–ª—é—á—ë–Ω |
| `SD enter: FAILED code=X` | –û—à–∏–±–∫–∞ –≤–∫–ª—é—á–µ–Ω–∏—è SD (–Ω–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å? SD –Ω–µ –∑–∞–ø—É—â–µ–Ω?) |
| `patch epicgames OK` | –ü–∞—Ç—á Epic Games –ø—Ä–∏–º–µ–Ω—ë–Ω |
| `patch RegistryPatch FAILED` | –û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ä–µ–µ—Å—Ç—Ä–æ–≤—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π |
| `restrictions: 28/28 OK` | –í—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –∏ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω—ã |
| `restrictions: 25/28 OK ‚Äî 3 MISSING` | 3 –∫–ª—é—á–∞ –Ω–µ —Å–æ–∑–¥–∞–ª–∏—Å—å ‚Äî —Å–º. —Å—Ç—Ä–æ–∫–∏ `missing:` –Ω–∏–∂–µ |
| `poll: session active ‚Äî starting setup` | –ù–∞–π–¥–µ–Ω–∞ –Ω–æ–≤–∞—è —Å–µ—Å—Å–∏—è –∞—Ä–µ–Ω–¥—ã |
| `poll: ssh unreachable` | –ü–ö –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ SSH (–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è?) |
| `poll: reboot required ‚Äî running cleanup` | ESME –Ω–µ –Ω–∞—à—ë–ª auth_token ‚Äî –ü–ö –Ω—É–∂–Ω–∞ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ |
| `poll: duplicate server registrations` | –î–≤–∞ server_id –≤ —Ä–µ–µ—Å—Ç—Ä–µ (—Ä–µ–¥–∫–∞—è —Å–∏—Ç—É–∞—Ü–∏—è) |
| `before_connect: done` | –í—Å–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω–µ–Ω—ã, —Å–µ—Å—Å–∏—è –≥–æ—Ç–æ–≤–∞ |
| `after_disconnect: SD exit+reboot` | –û—Ç–∫–∞—Ç SD + –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞ –ü–ö |
| `qwinsta exit_status=0 stdout=...` | –†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è session_id (DEBUG) |
| `starting explorer.exe in session 2` | PsExec –∑–∞–ø—É—Å–∫–∞–µ—Ç explorer –≤ –Ω—É–∂–Ω–æ–π —Å–µ—Å—Å–∏–∏ |
| `psexec exit_status=0` | explorer.exe –∑–∞–ø—É—â–µ–Ω —É—Å–ø–µ—à–Ω–æ |

### 9.3 –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ —Å—Ç–∞—Ä—Ç–æ–≤–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—É—Å–∫–µ –≤–æ—Ä–∫–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç –≤—Å–µ server_id –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞
2. –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–∞–∂–¥—ã–π —á–µ—Ä–µ–∑ Drova API ‚Äî –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–µ —É–¥–∞–ª—è–µ—Ç
3. –ï—Å–ª–∏ –Ω–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π: –≤—Ö–æ–¥–∏—Ç –≤ SD, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –ø–∞—Ç—á–∏, –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ä–µ–µ—Å—Ç—Ä, –≤—ã—Ö–æ–¥–∏—Ç –∏–∑ SD + reboot
4. –†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤ `/tmp/drova-status-<host>.json` –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤ –∫–æ–ª–æ–Ω–∫–µ **–î–∏–∞–≥–Ω.‚Üë** –≤–µ–±-UI

–õ–æ–≥–∏ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –≤—ã–≥–ª—è–¥—è—Ç —Ç–∞–∫:
```
[INFO]  diagnostic: start
[INFO]  cleanup: 1 server registrations found, verifying each  ‚Üê –µ—Å–ª–∏ > 1
[INFO]  sessions: none
[INFO]  SD enter: OK ‚Äî Drive C: Protected
[INFO]  patch epicgames      OK
[INFO]  patch steam          OK
[INFO]  patch ubisoft        OK
[INFO]  patch wargaming      OK
[INFO]  patch RegistryPatch  OK
[INFO]  restrictions: 28/28 OK
[INFO]  SD exit+reboot: OK
[INFO]  diagnostic: done
```

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `drova_web`, –∏—Ç–æ–≥ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤ UI (–∫–æ–ª–æ–Ω–∫–∞ **–î–∏–∞–≥–Ω.‚Üë**) –±–µ–∑ –¥–æ—Å—Ç—É–ø–∞ –∫ –ª–æ–≥–∞–º. –î–ª—è –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–µ–π (—Å–ø–∏—Å–æ–∫ –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö –∫–ª—é—á–µ–π, —É–ø–∞–≤—à–∏–µ –ø–∞—Ç—á–∏) –Ω–∞–≤–µ–¥–∏—Ç–µ –∫—É—Ä—Å–æ—Ä –Ω–∞ –∏–∫–æ–Ω–∫—É.

### 9.4 –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –≤—Ä—É—á–Ω—É—é

```bash
# –° Linux-–º–∞—à–∏–Ω—ã –≤–æ—Ä–∫–µ—Ä–∞:
ssh Administrator@192.168.1.100

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å qwinsta (—Å–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π):
ssh Administrator@192.168.1.100 qwinsta

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–µ—Å—Ç—Ä ESME:
ssh Administrator@192.168.1.100 "reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\ITKey\\Esme\\servers /s /f auth_token"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Shadow Defender:
ssh Administrator@192.168.1.100 '& "C:\\Program Files\\Shadow Defender\\CmdTool.exe" /pwd:"yourpassword" /list /now'
```

### 9.5 –ü—Ä–æ–≤–µ—Ä–∫–∞ Drova API –≤—Ä—É—á–Ω—É—é

```bash
# –ü–æ–ª—É—á–∏—Ç—å auth_token –∏–∑ —Ä–µ–µ—Å—Ç—Ä–∞ (–≤—ã–ø–æ–ª–Ω–∏—Ç—å –Ω–∞ Windows —á–µ—Ä–µ–∑ SSH):
ssh Administrator@192.168.1.100 "reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\ITKey\\Esme\\servers /s /f auth_token"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å API (–ø–æ–¥—Å—Ç–∞–≤–∏—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è):
curl -H "X-Auth-Token: YOUR_AUTH_TOKEN" \
     -d "serveri_id=YOUR_SERVER_ID" \
     https://services.drova.io/session-manager/sessions?
```

HTTP 200 ‚Äî —Ç–æ–∫–µ–Ω—ã –≤–∞–ª–∏–¥–Ω—ã. HTTP 401/403 ‚Äî –ü–ö –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –∏–ª–∏ —Ç–æ–∫–µ–Ω —É—Å—Ç–∞—Ä–µ–ª.

---

## 10. –°–ª—É–∂–µ–±–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã

### 10.1 `scripts/rollback_restrictions.ps1` ‚Äî —Ä—É—á–Ω–æ–π –æ—Ç–∫–∞—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –ï—Å–ª–∏ Shadow Defender –Ω–µ –≤—ã–ø–æ–ª–Ω–∏–ª –æ—Ç–∫–∞—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, —ç–∫—Å—Ç—Ä–µ–Ω–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞, —Ä—É—á–Ω—ã–µ —Ç–µ—Å—Ç—ã), —ç—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç —É–¥–∞–ª—è–µ—Ç –≤—Å–µ —Ä–µ–µ—Å—Ç—Ä–æ–≤—ã–µ –∫–ª—é—á–∏, —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –≤–æ—Ä–∫–µ—Ä–æ–º.

**–ó–∞–ø—É—Å–∫ –Ω–∞ Windows –ü–ö (PowerShell –æ—Ç –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞):**

```powershell
# –í–∞—Ä–∏–∞–Ω—Ç 1 ‚Äî –ª–æ–∫–∞–ª—å–Ω–æ –Ω–∞ –ü–ö:
powershell.exe -ExecutionPolicy Bypass -File "C:\scripts\rollback_restrictions.ps1"

# –í–∞—Ä–∏–∞–Ω—Ç 2 ‚Äî —á–µ—Ä–µ–∑ SSH —Å Linux:
scp scripts/rollback_restrictions.ps1 Administrator@192.168.1.100:C:\\rollback.ps1
ssh Administrator@192.168.1.100 "powershell.exe -ExecutionPolicy Bypass -File C:\\rollback.ps1"
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**

| –î–µ–π—Å—Ç–≤–∏–µ | –ö–ª—é—á —Ä–µ–µ—Å—Ç—Ä–∞ |
|---|---|
| –í–∫–ª—é—á–∞–µ—Ç CMD | –£–¥–∞–ª—è–µ—Ç `HKCU\...\System\DisableCMD` |
| –í–∫–ª—é—á–∞–µ—Ç Task Manager | –£–¥–∞–ª—è–µ—Ç `HKCU\...\System\DisableTaskMgr` |
| –í–∫–ª—é—á–∞–µ—Ç VBScript | –£–¥–∞–ª—è–µ—Ç `HKCU\...\Windows Script Host\Enabled` |
| –í–∫–ª—é—á–∞–µ—Ç –∫–Ω–æ–ø–∫—É –≤—ã–∫–ª—é—á–µ–Ω–∏—è | –£–¥–∞–ª—è–µ—Ç `HKCU\...\Explorer\NoClose` |
| –í–∫–ª—é—á–∞–µ—Ç –≤—ã—Ö–æ–¥ –∏–∑ —Å–∏—Å—Ç–µ–º—ã | –£–¥–∞–ª—è–µ—Ç `HKCU\...\Explorer\StartMenuLogoff`, `NoLogoff` |
| –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | –£–¥–∞–ª—è–µ—Ç `HKCU\...\Explorer\DisallowRun` + —Å–ø–∏—Å–æ–∫ 0..16 |
| –í–∫–ª—é—á–∞–µ—Ç gpedit, MMC | –£–¥–∞–ª—è–µ—Ç `DisableGpedit`, `RestrictToPermittedSnapins` |
| –í–∫–ª—é—á–∞–µ—Ç Fast User Switch | –£–¥–∞–ª—è–µ—Ç `HKLM\...\System\HideFastUserSwitching` (—Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞) |

**–í–∞–∂–Ω–æ:** HKLM-–∫–ª—é—á–∏ —Ç—Ä–µ–±—É—é—Ç –∑–∞–ø—É—Å–∫–∞ PowerShell –æ—Ç –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –°–∫—Ä–∏–ø—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–¥–∏—Ç, –µ—Å–ª–∏ –ø—Ä–∞–≤ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞–µ—Ç `gpupdate /target:user /force` –∏ —Å–æ–≤–µ—Ç—É–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å explorer –∏–ª–∏ –ø–µ—Ä–µlog–∏–Ω–∏—Ç—å—Å—è.

### 10.2 `drova_validate` ‚Äî –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
poetry run drova_validate
```

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. —Ä–∞–∑–¥–µ–ª [5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏](#5-–ø—Ä–æ–≤–µ—Ä–∫–∞-—Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏).

---

## 11. –û—à–∏–±–∫–∏ –∏ –∏—Ö —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ

### SSH –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω: `poll: ssh unreachable`

–ü–ö –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è (–ø–æ—Å–ª–µ AfterDisconnect) –∏–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ —Å–µ—Ç–∏. –í–æ—Ä–∫–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç –ø–æ–ø—ã—Ç–∫—É –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É ‚Äî —ç—Ç–æ —à—Ç–∞—Ç–Ω–∞—è —Å–∏—Ç—É–∞—Ü–∏—è.

**–ï—Å–ª–∏ –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è > 5 –º–∏–Ω—É—Ç:**
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∏—Ç–∞–Ω–∏–µ –∏ —Å–µ—Ç—å –ü–ö
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∑–∞–ø—É—â–µ–Ω –ª–∏ OpenSSH Server –Ω–∞ –ü–ö
- `ping 192.168.1.100`

### Reboot Required: `poll: reboot required ‚Äî running cleanup`

ESME-–∞–≥–µ–Ω—Ç Drova –Ω–µ —Å–æ–∑–¥–∞–ª –∫–ª—é—á–∏ –≤ —Ä–µ–µ—Å—Ç—Ä–µ (–Ω–µ –∑–∞–ø—É—â–µ–Ω –∏–ª–∏ —Ç–æ–ª—å–∫–æ —á—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω). –í–æ—Ä–∫–µ—Ä –∏–Ω–∏—Ü–∏–∏—Ä—É–µ—Ç AfterDisconnect (SD exit + reboot) –∏ –∂–¥—ë—Ç.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ ESME-–∞–≥–µ–Ω—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –Ω–∞ Windows –ü–ö.

### Shadow Defender FAILED

```
SD enter: FAILED code=1 ‚Äî Password is incorrect
```

–ù–µ–≤–µ—Ä–Ω—ã–π `SHADOW_DEFENDER_PASSWORD` –≤ `.env`. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–∞—Ä–æ–ª—å –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Shadow Defender –Ω–∞ –ü–ö.

```
SD enter: FAILED code=2
```

Shadow Defender –Ω–µ –∑–∞–ø—É—â–µ–Ω. –ù–∞ Windows –ü–ö: `services.msc` ‚Üí `Shadow Defender` ‚Üí –ó–∞–ø—É—Å—Ç–∏—Ç—å –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–∏–ø –∑–∞–ø—É—Å–∫–∞ ¬´–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏¬ª.

### PsExec: `PsExecNotFoundExecutable`

PsExec –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ `PATH` –Ω–∞ Windows –ü–ö, –∏–ª–∏ –∏–º—è –∏—Å–ø–æ–ª–Ω—è–µ–º–æ–≥–æ —Ñ–∞–π–ª–∞ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è.

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `psexec.exe` –¥–æ—Å—Ç—É–ø–µ–Ω:

```powershell
# –ù–∞ Windows –ü–ö:
where psexec
# –ï—Å–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω ‚Äî —Å–∫–∞—á–∞—Ç—å Sysinternals Suite –∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ PATH
```

### –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ server_id: `poll: duplicate server registrations`

–í —Ä–µ–µ—Å—Ç—Ä–µ –æ—Å—Ç–∞–ª–æ—Å—å –¥–≤–∞ server_id –æ—Ç —Ä–∞–∑–Ω—ã—Ö —É—Å—Ç–∞–Ω–æ–≤–æ–∫ ESME. –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º —Å—Ç–∞—Ä—Ç–µ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç –æ–±–∞ —á–µ—Ä–µ–∑ API –∏ —É–¥–∞–ª–∏—Ç –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π.

**–†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ (SSH):**

```bash
ssh Administrator@192.168.1.100 "reg query HKEY_LOCAL_MACHINE\\SOFTWARE\\ITKey\\Esme\\servers /s /f auth_token"
# –ù–∞–π—Ç–∏ –ª–∏—à–Ω–∏–π server_id –∏ —É–¥–∞–ª–∏—Ç—å:
ssh Administrator@192.168.1.100 'reg delete "HKEY_LOCAL_MACHINE\SOFTWARE\ITKey\Esme\servers\INVALID-UUID" /f'
```

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å: `restrictions: N/28 OK ‚Äî M MISSING`

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–µ–µ—Å—Ç—Ä–æ–≤—ã–µ –∫–ª—é—á–∏ –Ω–µ —Å–æ–∑–¥–∞–ª–∏—Å—å. –í –ª–æ–≥–∞—Ö –Ω–∏–∂–µ –±—É–¥—É—Ç —Å—Ç—Ä–æ–∫–∏ `missing: HKCU\...\...`.

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ SSH-–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è HKLM-–∫–ª—é—á–µ–π
- –í—Ä–µ–º–µ–Ω–Ω—ã–π —Å–±–æ–π SSH-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –ø–∞—Ç—á–∞

HKLM-–∫–ª—é—á `HideFastUserSwitching` —Ç—Ä–µ–±—É–µ—Ç –ø—Ä–∞–≤ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `WINDOWS_LOGIN` ‚Äî —ç—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø—Ä–∞–≤–∞–º–∏ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞.

### –õ–æ–≥–∏ –Ω–µ —Å–æ–∑–¥–∞—é—Ç—Å—è / `app.log` –ø—É—Å—Ç–æ–π

–§–∞–π–ª `app.log` —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ **—Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏** –ø—Ä–æ—Ü–µ—Å—Å–∞ (—Ç–∞–º, –æ—Ç–∫—É–¥–∞ –∑–∞–ø—É—â–µ–Ω `drova_poll`). –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ —á–µ—Ä–µ–∑ systemd —Ä–∞–±–æ—á–∞—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –∑–∞–¥–∞—ë—Ç—Å—è `WorkingDirectory=`.

```bash
# –ù–∞–π—Ç–∏ —Ñ–∞–π–ª –ª–æ–≥–∞:
find /opt/drova -name "app.log" 2>/dev/null
```

---

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (—à–ø–∞—Ä–≥–∞–ª–∫–∞)

```bash
# 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
poetry install

# 2. –°–æ–∑–¥–∞—Ç—å .env
cat > .env << EOF
WINDOWS_HOST=192.168.1.100
WINDOWS_LOGIN=Administrator
WINDOWS_PASSWORD=YourPassword
SHADOW_DEFENDER_PASSWORD=SDPassword
SHADOW_DEFENDER_DRIVES=C
EOF

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
poetry run drova_validate

# 4. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤–æ—Ä–∫–µ—Ä
poetry run drova_poll

# 5. –°–ª–µ–¥–∏—Ç—å –∑–∞ –ª–æ–≥–∞–º–∏ (–¥—Ä—É–≥–æ–π —Ç–µ—Ä–º–∏–Ω–∞–ª)
tail -f app.log
```
